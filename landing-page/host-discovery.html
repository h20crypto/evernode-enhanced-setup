<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Enhanced Evernode Host Discovery - Network Explorer</title>
    <link rel="stylesheet" href="/assets/css/unified-navigation.css">
    <script src="/assets/js/unified-state-manager.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            color: #ffffff;
            margin: 0;
            padding: 0;
            margin-top: 70px;
        }
        
        .discovery-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .discovery-header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
        }
        
        .discovery-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #00ff88;
        }
        
        .discovery-indicator {
            display: inline-block;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .network-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            border-color: rgba(0, 255, 136, 0.3);
        }
        
        .stat-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: #00ff88;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-trend {
            font-size: 0.8rem;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .search-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
        }
        
        .search-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #00ff88;
        }
        
        .search-controls {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px 16px;
            color: #ffffff;
            font-size: 0.9rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #00ff88;
            background: rgba(255, 255, 255, 0.15);
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .search-btn {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
        }
        
        .search-suggestions {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 10px;
        }
        
        .host-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
        }
        
        .host-list-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #00ff88;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .host-count {
            font-size: 0.9rem;
            opacity: 0.7;
            font-weight: normal;
        }
        
        .host-item {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #00ff88;
            transition: transform 0.2s ease;
        }
        
        .host-item:hover {
            transform: translateX(4px);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .host-info {
            flex: 1;
        }
        
        .host-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: #00ff88;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .host-address {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 4px;
        }
        
        .host-details {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 8px;
        }
        
        .host-features {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .feature-tag {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        .feature-tag.enhanced {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }
        
        .feature-tag.premium {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }
        
        .host-metrics {
            display: flex;
            gap: 20px;
            text-align: center;
        }
        
        .metric {
            min-width: 60px;
        }
        
        .metric-value {
            font-weight: 600;
            color: #00ff88;
            font-size: 0.9rem;
        }
        
        .metric-label {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 2px;
        }
        
        .host-ranking {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }
        
        .host-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            color: #00ff88;
        }
        
        .refresh-btn {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin: 20px auto;
            display: block;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
        }
        
        .last-updated {
            text-align: center;
            opacity: 0.6;
            font-size: 0.9rem;
            margin-top: 20px;
        }
        
        .your-host {
            border-left-color: #ffd700 !important;
            background: rgba(255, 215, 0, 0.05) !important;
        }
        
        .your-host .host-name {
            color: #ffd700;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #00ff88;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
        }
        
        .status-online {
            color: #10b981;
        }
        
        .status-offline {
            color: #ef4444;
        }
        
        @media (max-width: 768px) {
            .search-controls {
                grid-template-columns: 1fr;
            }
            
            .host-item {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .host-metrics {
                justify-content: space-around;
            }
        }
    </style>
</head>
<body>
    <!-- Unified Navigation -->
    <nav class="enhanced-nav">
        <div class="nav-container">
            <a href="/" class="nav-brand">üöÄ Enhanced Evernode</a>
            <div class="nav-links">
                <a href="/" class="nav-link">Dashboard</a>
                <a href="/monitoring-dashboard.html" class="nav-link">Monitoring</a>
                <a href="/my-earnings.html" class="nav-link">Earnings</a>
                <a href="/host-discovery.html" class="nav-link active">Discovery</a>
                <a href="/cluster/dapp-manager.html" class="nav-link admin-only">Cluster Manager</a>
            </div>
            <div class="nav-actions">
                <button class="nav-btn" onclick="toggleAdminMode()">üëë</button>
            </div>
        </div>
    </nav>

    <div class="discovery-container">
        <!-- Header -->
        <div class="discovery-header">
            <h1 class="discovery-title">üîç Host Discovery</h1>
            <p>Explore and discover the best Enhanced Evernode hosts across the network</p>
            <div class="discovery-indicator" id="discovery-status">
                <span class="loading-spinner"></span> Loading Network Data...
            </div>
        </div>

        <!-- Network Statistics -->
        <div class="network-stats">
            <div class="stat-card">
                <div class="stat-icon">üåê</div>
                <div class="stat-value" id="total-hosts">--</div>
                <div class="stat-label">Total Hosts</div>
                <div class="stat-trend">Network-wide</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="online-hosts">--</div>
                <div class="stat-label">Online Hosts</div>
                <div class="stat-trend">Available now</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üöÄ</div>
                <div class="stat-value" id="enhanced-hosts">--</div>
                <div class="stat-label">Enhanced Hosts</div>
                <div class="stat-trend">Professional grade</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-value" id="available-instances">--</div>
                <div class="stat-label">Available Instances</div>
                <div class="stat-trend">Ready to deploy</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value" id="avg-cost">--</div>
                <div class="stat-label">Avg Cost</div>
                <div class="stat-trend">Per hour (USD)</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üåç</div>
                <div class="stat-value" id="countries-count">--</div>
                <div class="stat-label">Countries</div>
                <div class="stat-trend">Global coverage</div>
            </div>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <h2 class="search-title">üîç Find the Perfect Host</h2>
            <div class="search-controls">
                <input type="text" class="search-input" placeholder="Search by r-address, email, domain, or country..." id="search-input">
                <select class="search-input" id="search-type">
                    <option value="all">üîç Smart Search</option>
                    <option value="address">üìç R-Address</option>
                    <option value="email">üìß Email</option>
                    <option value="domain">üåê Domain</option>
                </select>
                <select class="search-input" id="status-filter">
                    <option value="">All Status</option>
                    <option value="online">Online Only</option>
                    <option value="enhanced">Enhanced Only</option>
                    <option value="available">Available Capacity</option>
                </select>
                <button class="search-btn" onclick="performSearch()">üîç Search</button>
            </div>
            <div class="search-suggestions">
                üí° Examples: r3LraybyHdjNkDiavw7hGZLK3cESzekdNj ‚Ä¢ bisdaknode11@gmail.com ‚Ä¢ deluxenode.xyz ‚Ä¢ US
            </div>
        </div>

        <!-- Host List -->
        <div class="host-list">
            <h2 class="host-list-title">
                üèÜ Evernode Hosts
                <span class="host-count" id="host-count">Loading...</span>
            </h2>
            <div id="host-container">
                <!-- Loading indicator -->
                <div class="host-item" id="loading-indicator">
                    <div class="host-info">
                        <div class="host-name"><span class="loading-spinner"></span> Loading hosts from Evernode network...</div>
                        <div class="host-details">Fetching real-time data from api.evernode.network</div>
                    </div>
                </div>
            </div>
            
            <div id="no-results" class="no-results" style="display: none;">
                <h3>üîç No hosts found</h3>
                <p>Try adjusting your search criteria or filters</p>
            </div>
        </div>

        <button class="refresh-btn" onclick="refreshDiscoveryData()">üîÑ Refresh Host Discovery</button>
        
        <div class="last-updated" id="last-updated">
            Last updated: Never
        </div>
    </div>

    <script>
        // Enhanced Host Discovery System
        class EnhancedHostDiscovery {
            constructor() {
                this.allHosts = [];
                this.filteredHosts = [];
                this.currentHostAddress = null;
                this.init();
            }

            async init() {
                console.log('üîç Enhanced Host Discovery initializing...');
                
                // Get current host info
                await this.getCurrentHostInfo();
                
                // Load network data
                await this.loadNetworkData();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Auto-refresh every 5 minutes
                setInterval(() => {
                    this.loadNetworkData();
                }, 300000);
            }

            async getCurrentHostInfo() {
                try {
                    const response = await fetch('/api/host-info.php');
                    const data = await response.json();
                    this.currentHostAddress = data.xahau_address;
                } catch (error) {
                    console.log('Could not get current host info');
                }
            }

            setupEventListeners() {
                const searchInput = document.getElementById('search-input');
                const searchType = document.getElementById('search-type');
                
                // Real-time search as user types
                let searchTimeout;
                searchInput.addEventListener('input', () => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (searchInput.value.length > 2) {
                            this.performSearch();
                        } else if (searchInput.value.length === 0) {
                            this.displayHosts(this.allHosts);
                        }
                    }, 300);
                });

                // Auto-detect search type
                searchInput.addEventListener('input', () => {
                    this.autoDetectSearchType();
                });

                // Enter key search
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });
            }

            autoDetectSearchType() {
                const value = document.getElementById('search-input').value.trim();
                const searchType = document.getElementById('search-type');
                
                if (value.startsWith('r') && value.length > 20) {
                    searchType.value = 'address';
                } else if (value.includes('@')) {
                    searchType.value = 'email';
                } else if (value.includes('.')) {
                    searchType.value = 'domain';
                } else {
                    searchType.value = 'all';
                }
            }

            async loadNetworkData() {
                try {
                    this.updateDiscoveryStatus('‚ö° Fetching live data from Evernode API...');
                    
                    const response = await fetch('https://api.evernode.network/registry/hosts?limit=1000');
                    const data = await response.json();
                    
                    if (data.data && Array.isArray(data.data)) {
                        this.allHosts = data.data;
                        this.enhanceHostsData();
                        this.updateNetworkStats();
                        this.displayHosts(this.allHosts);
                        this.updateDiscoveryStatus('‚úÖ Network Scanner Active');
                    } else {
                        throw new Error('Invalid API response');
                    }
                    
                } catch (error) {
                    console.error('Failed to load from API:', error);
                    this.loadFallbackData();
                    this.updateDiscoveryStatus('‚ö†Ô∏è Using fallback data');
                }
                
                this.updateLastUpdated();
            }

            enhanceHostsData() {
                this.allHosts = this.allHosts.map(host => ({
                    ...host,
                    isOnline: this.determineOnlineStatus(host),
                    isEnhanced: this.detectEnhanced(host),
                    qualityScore: this.calculateQualityScore(host),
                    costUSD: this.calculateCostUSD(host),
                    countryFlag: this.getCountryFlag(host.countryCode),
                    features: this.detectFeatures(host),
                    utilization: this.calculateUtilization(host)
                }));
            }

            determineOnlineStatus(host) {
                if (!host.lastHeartbeatIndex) return false;
                const now = Math.floor(Date.now() / 1000);
                const diff = now - host.lastHeartbeatIndex;
                return diff < 3600; // Last hour
            }

            detectEnhanced(host) {
                const indicators = [
                    host.version === '1.0.0',
                    (host.hostRating || 0) > 200,
                    host.domain && (
                        host.domain.includes('enhanced') ||
                        host.domain.includes('premium') ||
                        host.domain.includes('pro')
                    ),
                    (host.cpuCount || 0) >= 4 && (host.ramMb || 0) >= 8000
                ];
                
                return indicators.filter(Boolean).length >= 2;
            }

            calculateQualityScore(host) {
                let score = 0;
                
                if (this.determineOnlineStatus(host)) score += 30;
                score += Math.min((host.cpuCount || 0) * 5, 20);
                score += Math.min((host.ramMb || 0) / 1000 * 10, 20);
                score += ((host.hostReputation || 0) / 255) * 15;
                
                const available = (host.maxInstances || 3) - (host.activeInstances || 0);
                score += Math.min(available * 3, 15);
                
                return Math.min(Math.round(score), 100);
            }

            calculateCostUSD(host) {
                const evrRate = parseFloat(host.leaseAmount || 0.001);
                const evrToUSD = 0.1825; // Current EVR price
                return (evrRate * evrToUSD).toFixed(4);
            }

            calculateUtilization(host) {
                const total = host.maxInstances || 3;
                const used = host.activeInstances || 0;
                return total > 0 ? Math.round((used / total) * 100) : 0;
            }

            getCountryFlag(countryCode) {
                const flags = {
                    'US': 'üá∫üá∏', 'FR': 'üá´üá∑', 'DE': 'üá©üá™', 'AT': 'üá¶üáπ', 'JP': 'üáØüáµ',
                    'GB': 'üá¨üáß', 'AU': 'üá¶üá∫', 'CA': 'üá®üá¶', 'CH': 'üá®üá≠', 'FI': 'üá´üáÆ',
                    'IE': 'üáÆüá™', 'PL': 'üáµüá±'
                };
                return flags[countryCode] || 'üåç';
            }

            detectFeatures(host) {
                const features = [];
                
                if (this.detectEnhanced(host)) features.push('Enhanced');
                if (this.determineOnlineStatus(host)) features.push('Online');
                if ((host.cpuCount || 0) >= 6) features.push('High CPU');
                if ((host.ramMb || 0) >= 16000) features.push('High RAM');
                if (host.version === '1.0.0') features.push('Latest');
                if ((host.hostReputation || 0) > 240) features.push('Top Rated');
                
                return features;
            }

            performSearch() {
                const query = document.getElementById('search-input').value.trim();
                const searchType = document.getElementById('search-type').value;
                const statusFilter = document.getElementById('status-filter').value;

                if (!query && !statusFilter) {
                    this.displayHosts(this.allHosts);
                    return;
                }

                let results = [...this.allHosts];

                // Apply text search
                if (query) {
                    const lowerQuery = query.toLowerCase();
                    
                    results = results.filter(host => {
                        switch (searchType) {
                            case 'address':
                                return (host.address || '').toLowerCase().includes(lowerQuery);
                            case 'email':
                                return (host.email || '').toLowerCase().includes(lowerQuery);
                            case 'domain':
                                return (host.domain || '').toLowerCase().includes(lowerQuery) ||
                                       (host.domainTLD || '').toLowerCase().includes(lowerQuery);
                            default: // Smart search
                                return (host.address || '').toLowerCase().includes(lowerQuery) ||
                                       (host.email || '').toLowerCase().includes(lowerQuery) ||
                                       (host.domain || '').toLowerCase().includes(lowerQuery) ||
                                       (host.domainTLD || '').toLowerCase().includes(lowerQuery) ||
                                       (host.countryCode || '').toLowerCase().includes(lowerQuery) ||
                                       (host.description || '').toLowerCase().includes(lowerQuery);
                        }
                    });
                }

                // Apply status filter
                if (statusFilter) {
                    results = results.filter(host => {
                        switch (statusFilter) {
                            case 'online':
                                return host.isOnline;
                            case 'enhanced':
                                return host.isEnhanced;
                            case 'available':
                                return (host.maxInstances || 3) > (host.activeInstances || 0);
                            default:
                                return true;
                        }
                    });
                }

                this.displayHosts(results);
            }

            updateNetworkStats() {
                const totalHosts = this.allHosts.length;
                const onlineHosts = this.allHosts.filter(h => h.isOnline).length;
                const enhancedHosts = this.allHosts.filter(h => h.isEnhanced).length;
                const totalInstances = this.allHosts.reduce((sum, h) => sum + (h.maxInstances || 3), 0);
                const usedInstances = this.allHosts.reduce((sum, h) => sum + (h.activeInstances || 0), 0);
                const availableInstances = totalInstances - usedInstances;
                const avgCost = this.allHosts.reduce((sum, h) => sum + parseFloat(h.costUSD || 0), 0) / totalHosts;
                const countries = new Set(this.allHosts.map(h => h.countryCode).filter(Boolean)).size;

                document.getElementById('total-hosts').textContent = totalHosts.toLocaleString();
                document.getElementById('online-hosts').textContent = onlineHosts.toLocaleString();
                document.getElementById('enhanced-hosts').textContent = enhancedHosts.toLocaleString();
                document.getElementById('available-instances').textContent = availableInstances.toLocaleString();
                document.getElementById('avg-cost').textContent = `$${avgCost.toFixed(4)}`;
                document.getElementById('countries-count').textContent = countries.toString();
            }

            displayHosts(hosts) {
                const container = document.getElementById('host-container');
                const hostCount = document.getElementById('host-count');
                const noResults = document.getElementById('no-results');
                
                // Sort hosts by quality score
                const sortedHosts = [...hosts].sort((a, b) => {
                    // Current host first
                    if (a.address === this.currentHostAddress) return -1;
                    if (b.address === this.currentHostAddress) return 1;
                    
                    // Then by quality score
                    return (b.qualityScore || 0) - (a.qualityScore || 0);
                });

                if (sortedHosts.length === 0) {
                    container.innerHTML = '';
                    noResults.style.display = 'block';
                    hostCount.textContent = 'No hosts found';
                    return;
                }

                noResults.style.display = 'none';
                hostCount.textContent = `${sortedHosts.length.toLocaleString()} hosts found`;

                container.innerHTML = sortedHosts.map(host => this.createHostCard(host)).join('');
            }

            createHostCard(host) {
                const isCurrentHost = host.address === this.currentHostAddress;
                const statusIcon = host.isOnline ? 'üü¢' : 'üî¥';
                const statusText = host.isOnline ? 'Online' : 'Offline';
                const available = (host.maxInstances || 3) - (host.activeInstances || 0);
                
                return `
                    <div class="host-item ${isCurrentHost ? 'your-host' : ''}">
                        <div class="host-info">
                            <div class="host-name">
                                ${host.countryFlag} ${host.domain || host.domainTLD || 'Unknown Domain'}
                                ${isCurrentHost ? 'üè†' : ''}
                                ${host.isEnhanced ? '<span class="feature-tag enhanced">Enhanced</span>' : ''}
                            </div>
                            <div class="host-address">${host.address}</div>
                            <div class="host-details">
                                ${statusIcon} ${statusText} ‚Ä¢ 
                                ${host.email || 'No email'} ‚Ä¢ 
                                Version ${host.version || 'Unknown'}
                                ${isCurrentHost ? ' ‚Ä¢ Your Host' : ''}
                            </div>
                            <div class="host-features">
                                ${host.features.map(feature => 
                                    `<span class="feature-tag">${feature}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div class="host-metrics">
                            <div class="metric">
                                <div class="metric-value">${available}/${host.maxInstances || 3}</div>
                                <div class="metric-label">Available</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">$${host.costUSD}</div>
                                <div class="metric-label">Cost/hr</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${host.utilization}%</div>
                                <div class="metric-label">Usage</div>
                            </div>
                        </div>
                        <div class="host-ranking">#${host.qualityScore}/100</div>
                        <div class="host-actions">
                            ${isCurrentHost ? 
                                '<button class="action-btn" onclick="manageHost()">‚öôÔ∏è Manage</button>' :
                                `<button class="action-btn" onclick="visitHost('${host.domain || host.address}')">üåê Visit</button>
                                 <button class="action-btn" onclick="deployToHost('${host.address}', '${host.domain}')">üöÄ Deploy</button>`
                            }
                        </div>
                    </div>
                `;
            }

            loadFallbackData() {
                // Use the existing fallback approach
                document.getElementById('total-hosts').textContent = '2,847';
                document.getElementById('online-hosts').textContent = '2,634';
                document.getElementById('enhanced-hosts').textContent = '247';
                document.getElementById('available-instances').textContent = '4,251';
                document.getElementById('avg-cost').textContent = '$0.0002';
                document.getElementById('countries-count').textContent = '67';
                
                // Show placeholder host
                document.getElementById('host-container').innerHTML = `
                    <div class="host-item your-host">
                        <div class="host-info">
                            <div class="host-name">üè† Your Host (yayathewisemushroom2.co)</div>
                            <div class="host-address">${this.currentHostAddress || 'rYourHostAddress...'}</div>
                            <div class="host-details">üü¢ Online ‚Ä¢ Enhanced Evernode v1.0 ‚Ä¢ Your Host</div>
                            <div class="host-features">
                                <span class="feature-tag enhanced">Enhanced</span>
                                <span class="feature-tag">Online</span>
                                <span class="feature-tag">Latest</span>
                            </div>
                        </div>
                        <div class="host-metrics">
                            <div class="metric">
                                <div class="metric-value">2/3</div>
                                <div class="metric-label">Available</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">$0.0002</div>
                                <div class="metric-label">Cost/hr</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">33%</div>
                                <div class="metric-label">Usage</div>
                            </div>
                        </div>
                        <div class="host-ranking">#85/100</div>
                        <div class="host-actions">
                            <button class="action-btn" onclick="manageHost()">‚öôÔ∏è Manage</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('host-count').textContent = 'Showing fallback data';
            }

            updateDiscoveryStatus(message) {
                document.getElementById('discovery-status').innerHTML = message;
            }

            updateLastUpdated() {
                const now = new Date().toLocaleString();
                document.getElementById('last-updated').textContent = `Last updated: ${now}`;
            }
        }

        // Global functions for existing compatibility
        function visitHost(hostname) {
            if (hostname.startsWith('r')) {
                // It's an address, need to find the domain
                window.open(`https://xahau.xrplwin.com/evernode?host=${hostname}`, '_blank');
            } else {
                window.open(`https://${hostname}`, '_blank');
            }
        }

        function deployToHost(address, domain) {
            const deployCommand = `evernode deploy --host=${domain || address} --instances=1`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(deployCommand).then(() => {
                    alert(`‚úÖ Deploy command copied to clipboard!\n\n${deployCommand}\n\nRun this in your terminal to deploy to ${domain || address}`);
                });
            } else {
                alert(`Deploy to ${domain || address}:\n\n${deployCommand}`);
            }
        }

        function manageHost() {
            window.location.href = '/cluster/dapp-manager.html';
        }

        function performSearch() {
            if (window.hostDiscovery) {
                window.hostDiscovery.performSearch();
            }
        }

        function refreshDiscoveryData() {
            if (window.hostDiscovery) {
                window.hostDiscovery.loadNetworkData();
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            window.hostDiscovery = new EnhancedHostDiscovery();
        });
    </script>
</body>
</html>
