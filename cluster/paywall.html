<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cluster Manager - Premium License</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .paywall-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .pricing {
            padding: 40px;
            text-align: center;
        }
        
        .price {
            font-size: 64px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .price-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 40px;
        }
        
        .payment-options {
            display: grid;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-crypto {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .features-list {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }
        
        .features-list h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .features-list ul {
            list-style: none;
            padding: 0;
        }
        
        .features-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .features-list li::before {
            content: "‚úì";
            color: #4CAF50;
            font-weight: bold;
            margin-right: 15px;
            font-size: 18px;
        }
        
        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close-modal {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .crypto-option {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .crypto-option:hover {
            border-color: #667eea;
            background: #e3f2fd;
        }
        
        .crypto-option.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }
        
        .license-form {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .license-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .payment-qr {
            text-align: center;
            padding: 20px;
        }
        
        .qr-code {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .crypto-rates {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .urgency {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="paywall-container">
        <div class="header">
            <h1>üöÄ Unlock Cluster Manager</h1>
            <p>Save 95% of your time with one-click cluster management</p>
        </div>
        
        <div class="pricing">
            <div class="price">$49.99</div>
            <div class="price-subtitle">One-time purchase ‚Ä¢ Lifetime access ‚Ä¢ NFT License</div>
            
            <div class="urgency">
                ‚ö†Ô∏è <strong>Every day you wait</strong> costs you $30+ in wasted time!
            </div>
            
            <div class="payment-options">
                <button onclick="showPurchaseOptions()" class="btn btn-primary">
                    üí≥ Credit Card / PayPal
                </button>
                
                <button onclick="showCryptoOptions()" class="btn btn-crypto">
                    ü™ô Pay with Crypto (XRP/EVR on Xahau)
                </button>
                
                <button onclick="showLicenseForm()" class="btn btn-secondary">
                    üîì I Have an NFT License
                </button>
            </div>
        </div>
        
        <div class="features-list">
            <h3>üéØ What You Get</h3>
            <ul>
                <li>Unlimited cluster creation and management</li>
                <li>One-click extensions for all instances (30 seconds vs 30+ minutes)</li>
                <li>Real-time monitoring dashboard across all hosts</li>
                <li>Cost tracking and ROI calculator</li>
                <li>NFT license stored in your Xahau wallet</li>
                <li>Priority technical support</li>
                <li>All future updates included forever</li>
                <li>30-day money-back guarantee</li>
            </ul>
        </div>
        
        <!-- License Activation Form -->
        <div id="licenseSection" style="display: none;">
            <div class="license-form">
                <h3>üîì Activate Your NFT License</h3>
                <p>Connect your Xahau wallet to verify your Cluster Manager NFT:</p>
                
                <input type="text" id="walletAddress" class="license-input" 
                       placeholder="Your Xahau wallet address (r...)" maxlength="34">
                
                <button onclick="verifyNFTLicense()" class="btn btn-primary">
                    Verify NFT License
                </button>
                
                <button onclick="connectXamanWallet()" class="btn btn-crypto">
                    Connect Xaman Wallet
                </button>
                
                <div id="licenseResult"></div>
            </div>
        </div>
    </div>
    
    <!-- Payment Modals -->
    <div id="cryptoModal" class="payment-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeCryptoModal()">&times;</span>
            <h2>ü™ô Crypto Payment Options</h2>
            <p>Pay with cryptocurrency on the Xahau network. Your license will be minted as an NFT!</p>
            
            <div class="crypto-rates" id="currentRates">
                Loading current rates...
            </div>
            
            <div class="crypto-option" onclick="selectCrypto('EVR')" id="evrOption">
                <h3>üåü EVR (Recommended)</h3>
                <p><strong>~2,500 EVR</strong> (Native Xahau currency)</p>
                <p>‚úÖ Lowest fees ‚Ä¢ ‚úÖ Fastest processing ‚Ä¢ ‚úÖ Native to Evernode ecosystem</p>
            </div>
            
            <div class="crypto-option" onclick="selectCrypto('XRP')" id="xrpOption">
                <h3>üíé XRP</h3>
                <p><strong>~120 XRP</strong> (Bridged from XRPL)</p>
                <p>‚úÖ Familiar currency ‚Ä¢ ‚úÖ Wide availability</p>
            </div>
            
            <div id="cryptoPaymentDetails" style="display: none;">
                <div class="payment-qr">
                    <h3>üì± Payment Instructions</h3>
                    <div id="paymentInstructions"></div>
                    <div class="qr-code" id="qrCodeContainer">
                        QR Code will appear here
                    </div>
                    <button onclick="confirmPayment()" class="btn btn-primary">
                        I've Sent Payment
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Traditional Payment Modal -->
    <div id="traditionalModal" class="payment-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeTraditionalModal()">&times;</span>
            <h2>üí≥ Traditional Payment</h2>
            <p>Pay with credit card or PayPal. Your NFT license will be delivered via email.</p>
            
            <div style="text-align: center; margin: 30px 0;">
                <button onclick="window.open('https://buy.stripe.com/your-stripe-link')" class="btn btn-primary">
                    Pay with Stripe ($49.99)
                </button>
                
                <button onclick="window.open('https://paypal.me/your-paypal-link')" class="btn btn-secondary">
                    Pay with PayPal ($49.99)
                </button>
            </div>
            
            <p style="font-size: 14px; color: #666; text-align: center;">
                Your NFT license will be minted and sent to your provided wallet address within 24 hours.
            </p>
        </div>
    </div>

    <script>
        let selectedCryptoCurrency = null;
        let currentRates = { evr: 0.02, xrp: 0.42 };
        
        // Load crypto rates
        async function loadCryptoRates() {
            try {
                const response = await fetch('/api/crypto-rates.php');
                const rates = await response.json();
                currentRates = rates;
                
                const evrAmount = (49.99 / rates.evr_rate).toFixed(0);
                const xrpAmount = (49.99 / rates.xrp_rate).toFixed(0);
                
                document.getElementById('currentRates').innerHTML = `
                    <strong>Current Rates:</strong><br>
                    EVR: $${rates.evr_rate} USD = ~${evrAmount} EVR for license<br>
                    XRP: $${rates.xrp_rate} USD = ~${xrpAmount} XRP for license<br>
                    <small>Rates update every 30 seconds</small>
                `;
                
                // Update option displays
                document.querySelector('#evrOption p').innerHTML = `<strong>~${evrAmount} EVR</strong> (Native Xahau currency)`;
                document.querySelector('#xrpOption p').innerHTML = `<strong>~${xrpAmount} XRP</strong> (Bridged from XRPL)`;
                
            } catch (error) {
                document.getElementById('currentRates').innerHTML = `
                    <strong>Estimated Rates:</strong><br>
                    EVR: ~2,500 EVR<br>
                    XRP: ~120 XRP<br>
                    <small>Contact support for exact amounts</small>
                `;
            }
        }
        
        function showPurchaseOptions() {
            document.getElementById('traditionalModal').style.display = 'flex';
        }
        
        function showCryptoOptions() {
            document.getElementById('cryptoModal').style.display = 'flex';
            loadCryptoRates();
        }
        
        function showLicenseForm() {
            document.getElementById('licenseSection').style.display = 'block';
            document.getElementById('licenseSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function selectCrypto(currency) {
            selectedCryptoCurrency = currency;
            
            // Update UI
            document.querySelectorAll('.crypto-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById(`${currency.toLowerCase()}Option`).classList.add('selected');
            
            // Generate payment details
            generateCryptoPayment(currency);
        }
        
        async function generateCryptoPayment(currency) {
            try {
                const response = await fetch('/api/xahau-nft-licenses.php?action=payment-request', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ currency: currency })
                });
                
                const payment = await response.json();
                
                const amount = currency === 'EVR' 
                    ? (49.99 / currentRates.evr_rate).toFixed(0) 
                    : (49.99 / currentRates.xrp_rate).toFixed(0);
                
                document.getElementById('paymentInstructions').innerHTML = `
                    <h4>Send exactly ${amount} ${currency} to:</h4>
                    <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; font-family: monospace; word-break: break-all; margin: 15px 0;">
                        ${payment.destination_address || 'rYourXahauPaymentAddress'}
                    </div>
                    <p><strong>Destination Tag:</strong> ${payment.destination_tag || '12345'}</p>
                    <p><strong>Network:</strong> Xahau (NetworkID: 21337)</p>
                    <p style="font-size: 14px; color: #666;">
                        Your NFT license will be automatically minted and sent to the sender address.
                    </p>
                `;
                
                // Generate QR code (simplified)
                document.getElementById('qrCodeContainer').innerHTML = `
                    <div style="background: #f0f0f0; padding: 20px; border-radius: 10px;">
                        <p>QR Code for ${currency} payment</p>
                        <p style="font-size: 12px; color: #666;">
                            Scan with Xaman wallet to send ${amount} ${currency}
                        </p>
                    </div>
                `;
                
                document.getElementById('cryptoPaymentDetails').style.display = 'block';
                
            } catch (error) {
                console.error('Payment generation failed:', error);
                document.getElementById('paymentInstructions').innerHTML = `
                    <p style="color: #d32f2f;">Error generating payment. Please contact support.</p>
                `;
            }
        }
        
        async function verifyNFTLicense() {
            const walletAddress = document.getElementById('walletAddress').value.trim();
            
            if (!walletAddress || !walletAddress.startsWith('r')) {
                showResult('licenseResult', 'Please enter a valid Xahau wallet address', 'error');
                return;
            }
            
            showResult('licenseResult', 'Verifying NFT license...', 'info');
            
            try {
                const response = await fetch('/api/xahau-nft-licenses.php?action=verify-license', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: walletAddress })
                });
                
                const result = await response.json();
                
                if (result.valid) {
                    showResult('licenseResult', `
                        ‚úÖ Valid Cluster Manager NFT found!<br>
                        <strong>NFT ID:</strong> ${result.nft_token_id}<br>
                        <strong>Issued:</strong> ${result.issued_date}<br>
                        <a href="/cluster/" style="color: #4CAF50; font-weight: bold;">Access Dashboard ‚Üí</a>
                    `, 'success');
                    
                    // Store license for future use
                    localStorage.setItem('cluster_nft_address', walletAddress);
                    localStorage.setItem('cluster_nft_id', result.nft_token_id);
                    
                } else {
                    showResult('licenseResult', `
                        ‚ùå No valid Cluster Manager NFT found in this wallet.<br>
                        <a href="#" onclick="showCryptoOptions()" style="color: #667eea;">Purchase NFT License</a>
                    `, 'error');
                }
                
            } catch (error) {
                showResult('licenseResult', 'Verification failed. Please try again.', 'error');
            }
        }
        
        async function connectXamanWallet() {
            if (typeof window.xumm !== 'undefined') {
                try {
                    const account = await window.xumm.user.account;
                    if (account) {
                        document.getElementById('walletAddress').value = account;
                        verifyNFTLicense();
                    }
                } catch (error) {
                    showResult('licenseResult', 'Xaman connection failed. Please enter address manually.', 'error');
                }
            } else {
                showResult('licenseResult', 'Xaman wallet not detected. Please install Xaman or enter address manually.', 'error');
            }
        }
        
        function confirmPayment() {
            if (!selectedCryptoCurrency) return;
            
            alert(`Payment confirmation received! Your NFT license will be minted within 5 minutes. Check your wallet and refresh this page.`);
            closeCryptoModal();
        }
        
        function closeCryptoModal() {
            document.getElementById('cryptoModal').style.display = 'none';
            selectedCryptoCurrency = null;
            document.getElementById('cryptoPaymentDetails').style.display = 'none';
            document.querySelectorAll('.crypto-option').forEach(opt => opt.classList.remove('selected'));
        }
        
        function closeTraditionalModal() {
            document.getElementById('traditionalModal').style.display = 'none';
        }
        
        function showResult(elementId, message, type) {
            const colors = {
                success: '#d4edda',
                error: '#f8d7da',
                info: '#d1ecf1'
            };
            
            document.getElementById(elementId).innerHTML = `
                <div class="${type}" style="background: ${colors[type]};">
                    ${message}
                </div>
            `;
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.payment-modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // Check if user already has NFT on page load
        window.addEventListener('load', function() {
            const savedAddress = localStorage.getItem('cluster_nft_address');
            if (savedAddress) {
                document.getElementById('walletAddress').value = savedAddress;
                showLicenseForm();
            }
        });
        
        // Update crypto rates every 30 seconds
        setInterval(loadCryptoRates, 30000);
    </script>
</body>
</html>
